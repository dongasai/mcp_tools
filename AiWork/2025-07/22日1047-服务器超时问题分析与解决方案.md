# 服务器超时问题分析与解决方案

## 问题描述
用户报告：虽然phpinfo显示超时时间为600秒，但实际请求仍然会在很短时间内超时。

## 分析结果

### 1. 当前配置状态
- **PHP配置**：`max_execution_time = 600`（已正确设置）
- **PHP配置**：`max_input_time = 600`（已正确设置）
- **PHP配置**：`default_socket_timeout = 600`（已正确设置）
- **容器配置**：使用Apache + PHP 8.2

### 2. 发现的关键问题

#### 2.1 Web服务器配置不完整
当前Apache配置缺少超时相关的指令设置，使用的是默认配置。

#### 2.2 容器运行模式问题
从`supervisord.local.conf`发现，容器实际运行的是：
- `php artisan serve --port=80 --host=0.0.0.0`（Laravel内置服务器）
- 而不是Apache Web服务器

**这是问题的根本原因！**

#### 2.3 Laravel内置服务器限制
Laravel的`php artisan serve`命令有以下限制：
- 默认超时时间较短（约30-60秒）
- 不适合生产环境使用
- 无法通过php.ini完全控制超时行为

### 3. 解决方案

#### 方案一：修复Apache配置（推荐）
1. 确保容器使用Apache而不是`php artisan serve`
2. 添加Apache超时配置
3. 配置Proxy超时设置

#### 方案二：调整Laravel Serve配置
1. 修改supervisord配置，增加超时参数
2. 使用PHP内置服务器参数调整超时

#### 方案三：使用PHP-FPM
1. 切换到PHP-FPM + Nginx组合
2. 配置FPM超时参数

## 实施步骤

### 立即修复方案（方案二）
修改`docker/supervisord.local.conf`中的laravel-serve配置：

```ini
[program:laravel-serve]
command=php artisan serve --port=80 --host=0.0.0.0 --tries=0 --timeout=0
```

### 长期解决方案（方案一）
1. 修改Dockerfile.dev，确保使用Apache
2. 更新Apache配置，添加超时设置
3. 移除laravel-serve，使用Apache作为Web服务器

## 验证步骤
1. 修改配置后重启容器
2. 访问http://127.0.0.1:34004/phpinfo.php确认设置
3. 运行长时间请求测试超时是否解决