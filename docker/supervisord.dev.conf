; 测试容器
[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:init-permissions]
command=bash -c "mkdir -p /var/www/html/storage/logs /var/www/html/storage/app/public /var/www/html/storage/framework/cache /var/www/html/storage/framework/sessions /var/www/html/storage/framework/views /var/www/html/bootstrap/cache && chown -R appuser:appuser /var/www/html/storage /var/www/html/bootstrap/cache && chmod -R 777 /var/www/html/storage /var/www/html/bootstrap/cache"
directory=/var/www/html
autostart=true
autorestart=false
user=root
stdout_logfile=/var/log/supervisor/init-permissions.log
stderr_logfile=/var/log/supervisor/init-permissions.log

[program:build-cache]
command=bash -c "composer run build-cache"
directory=/var/www/html
autostart=true
autorestart=false
user=appuser
stdout_logfile=/var/log/supervisor/build-cache.log
stderr_logfile=/var/log/supervisor/build-cache.log

[program:laravel-serve]
command=php artisan serve --port=80 --host=0.0.0.0
directory=/var/www/html
autostart=true
autorestart=true
user=appuser
stdout_logfile=/var/log/supervisor/laravel-serve.log
stderr_logfile=/var/log/supervisor/laravel-serve.log

[program:queue-worker]
command=php artisan queue:listen -v --sleep=3 --tries=3
directory=/var/www/html
autostart=true
autorestart=true
user=appuser
stdout_logfile=/var/log/supervisor/queue-worker.log
stderr_logfile=/var/log/supervisor/queue-worker.log

[program:schedule-worker]
command=php artisan schedule:work -v
directory=/var/www/html
autostart=true
autorestart=true
user=appuser
stdout_logfile=/var/log/supervisor/schedule-worker.log
stderr_logfile=/var/log/supervisor/schedule-worker.log

[program:mcp-server]
command=php artisan mcp:serve
directory=/var/www/html
autostart=true
autorestart=true
user=appuser
stdout_logfile=/var/log/supervisor/mcp-server.log
stderr_logfile=/var/log/supervisor/mcp-server.log

; [program:log-monitor]
; command=php artisan pail --timeout=0
; directory=/var/www/html
; autostart=true
; autorestart=true
; user=appuser
; stdout_logfile=/var/log/supervisor/log-monitor.log
; stderr_logfile=/var/log/supervisor/log-monitor.log
