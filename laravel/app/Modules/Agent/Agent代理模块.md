# Agent ä»£ç†æ¨¡å—

## æ¦‚è¿°

Agentä»£ç†æ¨¡å—è´Ÿè´£ç®¡ç†AI Agentçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬æ³¨å†Œã€è®¤è¯ã€æƒé™æ§åˆ¶ã€çŠ¶æ€ç®¡ç†ç­‰ã€‚è¯¥æ¨¡å—æ˜¯MCP Toolsç³»ç»Ÿä¸­Agentç®¡ç†çš„æ ¸å¿ƒï¼Œç¡®ä¿æ¯ä¸ªAgentéƒ½æœ‰æ˜ç¡®çš„èº«ä»½æ ‡è¯†å’Œè®¿é—®æƒé™ã€‚Agentæ¨¡å—ä¸Useræ¨¡å—åä½œï¼Œä½†ä¸“æ³¨äºAI Agentçš„ç®¡ç†ï¼Œä¸ç›´æ¥å¤„ç†äººç±»ç”¨æˆ·çš„ç®¡ç†ã€‚

## èŒè´£èŒƒå›´

### 1. Agentç”Ÿå‘½å‘¨æœŸç®¡ç†
- Agentæ³¨å†Œå’Œæ³¨é”€
- AgentçŠ¶æ€ç›‘æ§
- Agenté…ç½®ç®¡ç†
- Agentæ€§èƒ½ç»Ÿè®¡

### 2. èº«ä»½è®¤è¯ä¸æˆæƒ
- è®¿é—®ä»¤ç‰Œç®¡ç†
- æƒé™éªŒè¯æœºåˆ¶
- è§’è‰²æƒé™æ§åˆ¶
- å®‰å…¨å®¡è®¡æ—¥å¿—

### 3. é¡¹ç›®è®¿é—®æ§åˆ¶
- é¡¹ç›®çº§æƒé™ç®¡ç†
- èµ„æºè®¿é—®æ§åˆ¶
- æ“ä½œæƒé™éªŒè¯
- åŠ¨æ€æƒé™è°ƒæ•´

### 4. Agentåä½œç®¡ç†
- å¤šAgentåè°ƒ
- ä»»åŠ¡åˆ†é…ç­–ç•¥
- å†²çªæ£€æµ‹å’Œè§£å†³
- è´Ÿè½½å‡è¡¡

### 5. Agentäº¤äº’åŠŸèƒ½
- Agentå‘äººç±»ç”¨æˆ·æé—®
- é—®é¢˜ç±»å‹ç®¡ç†ï¼ˆé€‰æ‹©ç±»ã€åé¦ˆç±»ï¼‰
- é—®é¢˜ä¼˜å…ˆçº§æ§åˆ¶
- å®æ—¶é€šçŸ¥å’ŒçŠ¶æ€è·Ÿè¸ª

## èŒè´£è¾¹ç•Œ

### âœ… Agentæ¨¡å—è´Ÿè´£
- AI Agentçš„æ³¨å†Œã€è®¤è¯å’Œç®¡ç†
- Agentè®¿é—®ä»¤ç‰Œçš„ç”Ÿæˆå’ŒéªŒè¯
- Agentå¯¹é¡¹ç›®å’Œèµ„æºçš„æƒé™æ§åˆ¶
- Agentä¼šè¯ç®¡ç†å’ŒçŠ¶æ€è·Ÿè¸ª
- Agentä¹‹é—´çš„åä½œå’Œå†²çªè§£å†³
- ä¸ºMCPåè®®æä¾›Agentèº«ä»½éªŒè¯
- Agentå‘äººç±»ç”¨æˆ·çš„æé—®åŠŸèƒ½

### âŒ Agentæ¨¡å—ä¸è´Ÿè´£
- äººç±»ç”¨æˆ·çš„è´¦æˆ·ç®¡ç†ï¼ˆç”±Useræ¨¡å—å¤„ç†ï¼‰
- äººç±»ç”¨æˆ·çš„ç™»å½•è®¤è¯ï¼ˆç”±Useræ¨¡å—å¤„ç†ï¼‰
- MCPåè®®çš„å…·ä½“å®ç°ï¼ˆç”±MCPæ¨¡å—å¤„ç†ï¼‰
- å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œï¼ˆå§”æ‰˜ç»™ä¸šåŠ¡æ¨¡å—ï¼‰

### ğŸ”„ ä¸å…¶ä»–æ¨¡å—çš„åä½œ
- **Useræ¨¡å—**ï¼šè·å–Agentæ‰€å±ç”¨æˆ·çš„ä¿¡æ¯å’Œæƒé™
- **MCPæ¨¡å—**ï¼šä¸ºMCPè¿æ¥æä¾›Agentè®¤è¯æœåŠ¡
- **Projectæ¨¡å—**ï¼šéªŒè¯Agentå¯¹é¡¹ç›®çš„è®¿é—®æƒé™
- **Taskæ¨¡å—**ï¼šéªŒè¯Agentå¯¹ä»»åŠ¡çš„æ“ä½œæƒé™

## ç›®å½•ç»“æ„

```
app/Modules/Agent/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Agent.php                  # Agentæ¨¡å‹
â”‚   â”œâ”€â”€ AgentPermission.php        # Agentæƒé™æ¨¡å‹
â”‚   â”œâ”€â”€ AgentSession.php           # Agentä¼šè¯æ¨¡å‹
â”‚   â”œâ”€â”€ AgentQuestion.php          # Agentæé—®æ¨¡å‹
â”‚   â””â”€â”€ AgentAuditLog.php          # Agentå®¡è®¡æ—¥å¿—æ¨¡å‹
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ AgentService.php           # Agentæ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ AuthenticationService.php  # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ AuthorizationService.php   # æˆæƒæœåŠ¡
â”‚   â”œâ”€â”€ PermissionService.php      # æƒé™ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ SessionService.php         # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ QuestionService.php        # æé—®ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ QuestionNotificationService.php # æé—®é€šçŸ¥æœåŠ¡
â”‚   â””â”€â”€ QuestionAnalyticsService.php # æé—®åˆ†ææœåŠ¡
â”œâ”€â”€ Commands/
â”‚   â”œâ”€â”€ RegisterAgentCommand.php   # æ³¨å†ŒAgentå‘½ä»¤
â”‚   â”œâ”€â”€ ListAgentsCommand.php      # åˆ—å‡ºAgentå‘½ä»¤
â”‚   â”œâ”€â”€ RevokeAgentCommand.php     # æ’¤é”€Agentå‘½ä»¤
â”‚   â””â”€â”€ GrantPermissionCommand.php # æˆæƒå‘½ä»¤
â”œâ”€â”€ Policies/
â”‚   â”œâ”€â”€ AgentPolicy.php            # Agentè®¿é—®ç­–ç•¥
â”‚   â”œâ”€â”€ ProjectAccessPolicy.php    # é¡¹ç›®è®¿é—®ç­–ç•¥
â”‚   â””â”€â”€ ResourceAccessPolicy.php   # èµ„æºè®¿é—®ç­–ç•¥
â”œâ”€â”€ Events/
â”‚   â”œâ”€â”€ AgentRegistered.php        # Agentæ³¨å†Œäº‹ä»¶
â”‚   â”œâ”€â”€ AgentAuthenticated.php     # Agentè®¤è¯äº‹ä»¶
â”‚   â”œâ”€â”€ PermissionGranted.php      # æƒé™æˆäºˆäº‹ä»¶
â”‚   â”œâ”€â”€ PermissionRevoked.php      # æƒé™æ’¤é”€äº‹ä»¶
â”‚   â”œâ”€â”€ AgentSessionExpired.php    # ä¼šè¯è¿‡æœŸäº‹ä»¶
â”‚   â”œâ”€â”€ QuestionCreated.php        # é—®é¢˜åˆ›å»ºäº‹ä»¶
â”‚   â”œâ”€â”€ QuestionAnswered.php       # é—®é¢˜å›ç­”äº‹ä»¶
â”‚   â””â”€â”€ QuestionIgnored.php        # é—®é¢˜å¿½ç•¥äº‹ä»¶
â”œâ”€â”€ Listeners/
â”‚   â”œâ”€â”€ LogAgentActivity.php       # è®°å½•Agentæ´»åŠ¨
â”‚   â”œâ”€â”€ UpdateAgentStatus.php      # æ›´æ–°AgentçŠ¶æ€
â”‚   â””â”€â”€ NotifyPermissionChange.php # é€šçŸ¥æƒé™å˜æ›´
â”œâ”€â”€ Middleware/
â”‚   â”œâ”€â”€ AgentAuthMiddleware.php    # Agentè®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ PermissionMiddleware.php   # æƒé™æ£€æŸ¥ä¸­é—´ä»¶
â”‚   â””â”€â”€ SessionMiddleware.php      # ä¼šè¯ç®¡ç†ä¸­é—´ä»¶
â”œâ”€â”€ Contracts/
â”‚   â”œâ”€â”€ AgentServiceInterface.php  # AgentæœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ AuthServiceInterface.php   # è®¤è¯æœåŠ¡æ¥å£
â”‚   â””â”€â”€ PermissionInterface.php    # æƒé™æ¥å£
â””â”€â”€ Exceptions/
    â”œâ”€â”€ AgentNotFoundException.php  # Agentæœªæ‰¾åˆ°å¼‚å¸¸
    â”œâ”€â”€ AuthenticationException.php # è®¤è¯å¼‚å¸¸
    â”œâ”€â”€ AuthorizationException.php  # æˆæƒå¼‚å¸¸
    â””â”€â”€ PermissionDeniedException.php # æƒé™æ‹’ç»å¼‚å¸¸
```

## æ ¸å¿ƒæœåŠ¡

### 1. AgentService

AgentService è´Ÿè´£ç®¡ç† Agent çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬æ³¨å†Œã€çŠ¶æ€æ›´æ–°ã€ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯ç­‰åŠŸèƒ½ã€‚

### 2. AuthenticationService

AuthenticationService å¤„ç† Agent çš„è®¤è¯é€»è¾‘ï¼ŒåŒ…æ‹¬ä»¤ç‰ŒéªŒè¯ã€åˆ·æ–°å’Œæ’¤é”€ç­‰æ“ä½œã€‚

### 3. AuthorizationService

AuthorizationService æä¾›æƒé™éªŒè¯åŠŸèƒ½ï¼Œç¡®ä¿ Agent åªèƒ½è®¿é—®å…¶æˆæƒçš„é¡¹ç›®å’Œèµ„æºã€‚

### 4. PermissionService

PermissionService å®šä¹‰å’Œç®¡ç†æƒé™å¸¸é‡ï¼Œå¹¶æä¾›æƒé™éªŒè¯å’Œè®¡ç®—åŠŸèƒ½ã€‚

<?php

namespace App\Modules\Agent\Services;

class AuthorizationService
{
    /**
     * æ£€æŸ¥é¡¹ç›®è®¿é—®æƒé™
     */
    public function canAccessProject(Agent $agent, int $projectId): bool;

    /**
     * æ£€æŸ¥æ“ä½œæƒé™
     */
    public function canPerformAction(Agent $agent, string $action): bool;

    /**
     * æ£€æŸ¥èµ„æºè®¿é—®æƒé™
     */
    public function canAccessResource(Agent $agent, string $resource): bool;

    /**
     * è·å–Agentæƒé™åˆ—è¡¨
     */
    public function getPermissions(Agent $agent): array;

    /**
     * æˆäºˆæƒé™
     */
    public function grantPermission(Agent $agent, string $permission, array $scope = []): bool;

    /**
     * æ’¤é”€æƒé™
     */
    public function revokePermission(Agent $agent, string $permission): bool;

    /**
     * æ£€æŸ¥æƒé™èŒƒå›´
     */
    public function checkScope(Agent $agent, string $permission, array $context): bool;
}
## Agentæ¨¡å‹æ‰©å±•

### Agentæƒé™æ¨¡å‹

Agentæƒé™æ¨¡å‹ç”¨äºç®¡ç†Agentçš„æƒé™ï¼ŒåŒ…æ‹¬æƒé™çš„æˆäºˆã€éªŒè¯å’ŒèŒƒå›´æ£€æŸ¥ã€‚

### Agentä¼šè¯æ¨¡å‹

Agentä¼šè¯æ¨¡å‹ç”¨äºç®¡ç†Agentçš„ä¼šè¯çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¼šè¯çš„åˆ›å»ºã€æ›´æ–°å’Œç»ˆæ­¢ã€‚

## æƒé™ç­–ç•¥

### Agentè®¿é—®ç­–ç•¥

Agentè®¿é—®ç­–ç•¥å®šä¹‰äº†ç”¨æˆ·å¯¹Agentçš„æŸ¥çœ‹ã€æ›´æ–°ã€åˆ é™¤å’Œæƒé™ç®¡ç†æƒé™ã€‚

### é¡¹ç›®è®¿é—®ç­–ç•¥

é¡¹ç›®è®¿é—®ç­–ç•¥å®šä¹‰äº†Agentå¯¹é¡¹ç›®çš„è®¿é—®æƒé™å’Œæ“ä½œæƒé™ã€‚

## å‘½ä»¤è¡Œå·¥å…·

### æ³¨å†ŒAgentå‘½ä»¤

æ³¨å†ŒAgentå‘½ä»¤ç”¨äºé€šè¿‡å‘½ä»¤è¡Œæ³¨å†Œæ–°çš„Agentï¼Œå¹¶ç”Ÿæˆè®¿é—®ä»¤ç‰Œã€‚

## äº‹ä»¶å’Œç›‘å¬å™¨

### Agentäº‹ä»¶

Agentäº‹ä»¶åŒ…æ‹¬æ³¨å†Œã€è®¤è¯å’Œæƒé™æˆäºˆç­‰å…³é”®æ“ä½œçš„äº‹ä»¶å®šä¹‰ã€‚

### äº‹ä»¶ç›‘å¬å™¨

äº‹ä»¶ç›‘å¬å™¨ç”¨äºå“åº”Agentäº‹ä»¶ï¼Œå¦‚è®°å½•æ´»åŠ¨æ—¥å¿—å’Œæ›´æ–°AgentçŠ¶æ€ã€‚

## ä¸­é—´ä»¶

### Agentè®¤è¯ä¸­é—´ä»¶

Agentè®¤è¯ä¸­é—´ä»¶ç”¨äºéªŒè¯Agentçš„è®¿é—®ä»¤ç‰Œå¹¶ç®¡ç†ä¼šè¯çŠ¶æ€ã€‚

## é…ç½®ç®¡ç†

é…ç½®ç®¡ç†å®šä¹‰äº†Agentæ¨¡å—çš„ä»¤ç‰Œã€ä¼šè¯ã€æƒé™å’Œé€Ÿç‡é™åˆ¶ç­‰å…³é”®å‚æ•°ã€‚

**ç›¸å…³æ–‡æ¡£**ï¼š
- [Agentæé—®åŠŸèƒ½è®¾è®¡](./docs/Agentæé—®åŠŸèƒ½è®¾è®¡.md)
- [MCPåè®®æ¨¡å—](./MCPåè®®æ¦‚è¿°.md)
- [é¡¹ç›®æ¨¡å—](./project.md)
- [ä»»åŠ¡æ¨¡å—](./task.md)
